<!DOCTYPE html>
<html lang="pt-br">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Dashboard SEI</title>
    <!-- Bootstrap CSS -->
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.2/dist/css/bootstrap.min.css" rel="stylesheet" integrity="sha384-T3c6CoIi6uLrA9TneNEoa7RxnatzjcDSCmG1MXxSR1GAsXEV/Dwwykc2MPK8M2HN" crossorigin="anonymous">
    <!-- Plotly.js CDN -->
    <script src="https://cdn.plot.ly/plotly-latest.min.js"></script>
    <style>
        body {
            background-color: #f8f9fa; /* Light gray background */
        }
        .navbar {
            background-color: #007bff; /* Primary blue for navbar */
        }
        .navbar-brand {
            color: #fff !important;
            font-weight: bold;
        }
        .card {
            border: none;
            border-radius: 0.75rem;
            box-shadow: 0 0.5rem 1rem rgba(0, 0, 0, 0.1);
            margin-bottom: 1.5rem;
        }
        .card-header {
            background-color: #e9ecef;
            border-bottom: 1px solid rgba(0, 0, 0, 0.125);
            font-weight: bold;
            color: #343a40;
        }
        .chart-container {
            min-height: 300px; /* Ensure charts have enough space */
        }
        .table-responsive {
            max-height: 400px; /* Limit height of the table for scrolling */
            overflow-y: auto;
        }
    </style>
</head>
<body>
    <nav class="navbar navbar-expand-lg navbar-dark">
        <div class="container-fluid">
            <a class="navbar-brand" href="#">Dashboard SEI</a>
        </div>
    </nav>

    <div class="container mt-4">
        <h1 class="mb-4 text-center text-primary">Visão Geral da Planilha</h1>

        <div class="row">
            <div class="col-md-6">
                <div class="card">
                    <div class="card-header">
                        Distribuição por Status
                    </div>
                    <div class="card-body">
                        <div id="statusChart" class="chart-container"></div>
                    </div>
                </div>
            </div>
            <div class="col-md-6">
                <div class="card">
                    <div class="card-header">
                        Distribuição por Tipo
                    </div>
                    <div class="card-body">
                        <div id="typeChart" class="chart-container"></div>
                    </div>
                </div>
            </div>
        </div>

        <div class="row">
            <div class="col-12">
                <div class="card">
                    <div class="card-header">
                        Dados Completos da Planilha
                    </div>
                    <div class="card-body">
                        <div class="table-responsive">
                            <table class="table table-striped table-hover">
                                <thead>
                                    <tr>
                                        {% if data %}
                                            {% for key in data[0].keys() %}
                                                <th scope="col">{{ key }}</th>
                                            {% endfor %}
                                        {% else %}
                                            <th scope="col">Nenhum dado disponível</th>
                                        {% endif %}
                                    </tr>
                                </thead>
                                <tbody>
                                    {% for row in data %}
                                        <tr>
                                            {% for value in row.values() %}
                                                <td>{{ value }}</td>
                                            {% endfor %}
                                        </tr>
                                    {% endfor %}
                                </tbody>
                            </table>
                        </div>
                        {% if not data %}
                            <p class="text-muted text-center">Nenhum dado encontrado ou erro ao carregar.</p>
                        {% endif %}
                    </div>
                </div>
            </div>
        </div>
    </div>

    <!-- Bootstrap JS Bundle -->
    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.2/dist/js/bootstrap.bundle.min.js" integrity="sha384-C6RzsynM9kWDrMNeT87bh95OGNyZPhcTNXj1NW7RuBCsyN/o0jlpcV8Qyq46cDfL" crossorigin="anonymous"></script>

    <script>
        // Recebe os dados do Flask (Jinja2)
        var rawData = {{ data | tojson }};

        // Função para preparar dados para gráficos
        function prepareChartData(data, categoryField) {
            var counts = {};
            data.forEach(function(row) {
                var category = row[categoryField];
                if (category) { // Ignora valores vazios
                    counts[category] = (counts[category] || 0) + 1;
                }
            });
            return {
                labels: Object.keys(counts),
                values: Object.values(counts)
            };
        }

        // Preparar dados para o gráfico de Status
        var statusChartData = prepareChartData(rawData, 'Status'); // Altere 'Status' se sua coluna tiver outro nome
        var statusTrace = {
            labels: statusChartData.labels,
            values: statusChartData.values,
            type: 'pie',
            hole: .4, // Para um gráfico de donut
            name: 'Status'
        };
        var statusLayout = {
            title: 'Distribuição por Status',
            height: 300,
            margin: {t: 40, b: 20, l: 20, r: 20}
        };
        Plotly.newPlot('statusChart', [statusTrace], statusLayout);

        // Preparar dados para o gráfico de Tipo
        var typeChartData = prepareChartData(rawData, 'Tipo'); // Altere 'Tipo' se sua coluna tiver outro nome
        var typeTrace = {
            x: typeChartData.labels,
            y: typeChartData.values,
            type: 'bar',
            name: 'Tipo',
            marker: {
                color: 'rgba(58,200,225,.5)',
                line: {
                    color: 'rgba(58,200,225,1)',
                    width: 1
                }
            }
        };
        var typeLayout = {
            title: 'Contagem por Tipo',
            height: 300,
            margin: {t: 40, b: 20, l: 20, r: 20}
        };
        Plotly.newPlot('typeChart', [typeTrace], typeLayout);

    </script>
</body>
</html>